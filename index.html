<html lang="en">
	<head>
		<meta charset="utf-8">
		<script type="text/javascript" src="./d3/d3.min.js"></script>
		
		<style type="text/css">
			#tooltip {
							position: absolute;
							width: 180px;
							height: auto;
							padding: 5px;
							background-color: white;
							-webkit-border-radius: 10px;
					    	-moz-border-radius: 10px;
							border-radius: 10px;
							-webkit-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
							-moz-box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
							box-shadow: 4px 4px 10px rgba(0, 0, 0, 0.4);
							pointer-events: none;
			}
			
			#tooltip.hidden {
							display: none;
						}
			
			#tooltip p {
							margin: 0;
							font-family: sans-serif;
							font-size: 12px;
							line-height: 20px;
							color: grey;
			}	
		select { position: absolute; right: 0px; top: 924px; }				
			
		</style>
	  
	  </head>
        <body>
		<div id="tooltip" class="hidden">
					<p><span id="year">100</span></p>
					<p><span id="country">100</span></p>
					<p><span id="state">100</span></p>
					<p><span id="value">100</span></p>
		</div>
		<select id="cityselector">
			<option value="0">Aa en Hunze</option>
			<option value="1">Aalburg</option>
			<option value="2">Aalsmeer</option>
			<option value="3">Aalten</option>
			<option value="4">Achtkarspelen</option>
			<option value="5">Alblasserdam</option>
			<option value="6">Albrandswaard</option>
			<option value="7">Alkmaar</option>
			<option value="8">Almelo</option>
			<option value="9">Almere</option>
			<option value="10">Alphen aan den Rijn</option>
			<option value="11">Alphen-Chaam</option>
			<option value="12">Ameland</option>
			<option value="13">Amersfoort</option>
			<option value="14">Amstelveen</option>
			<option value="15">Amsterdam</option>
			<option value="16">Apeldoorn</option>
			<option value="17">Appingedam</option>
			<option value="18">Arnhem</option>
			<option value="19">Assen</option>
			<option value="20">Asten</option>
			<option value="21">Baarle-Nassau</option>
			<option value="22">Baarn</option>
			<option value="23">Barendrecht</option>
			<option value="24">Barneveld</option>
			<option value="25">Bedum</option>
			<option value="26">Beek</option>
			<option value="27">Beemster</option>
			<option value="28">Beesel</option>
			<option value="29">Bellingwedde</option>
			<option value="30">Bergambacht</option>
			<option value="31">Bergeijk</option>
			<option value="32">Bergen (L.)</option>
			<option value="33">Bergen (NH.)</option>
			<option value="34">Bergen op Zoom</option>
			<option value="35">Berkelland</option>
			<option value="36">Bernheze</option>
			<option value="37">Bernisse</option>
			<option value="38">Best</option>
			<option value="39">Beuningen</option>
			<option value="40">Beverwijk</option>
			<option value="41">Binnenmaas</option>
			<option value="42">Bladel</option>
			<option value="43">Blaricum</option>
			<option value="44">Bloemendaal</option>
			<option value="45">Boarnsterhim</option>
			<option value="46">Bodegraven-Reeuwijk</option>
			<option value="47">Boekel</option>
			<option value="48">Borger-Odoorn</option>
			<option value="49">Borne</option>
			<option value="50">Borsele</option>
			<option value="51">Boskoop</option>
			<option value="52">Boxmeer</option>
			<option value="53">Boxtel</option>
			<option value="54">Breda</option>
			<option value="55">Brielle</option>
			<option value="56">Bronckhorst</option>
			<option value="57">Brummen</option>
			<option value="58">Brunssum</option>
			<option value="59">Bunnik</option>
			<option value="60">Bunschoten</option>
			<option value="61">Buren</option>
			<option value="62">Bussum</option>
			<option value="63">Capelle aan den IJssel</option>
			<option value="64">Castricum</option>
			<option value="65">Coevorden</option>
			<option value="66">Cranendonck</option>
			<option value="67">Cromstrijen</option>
			<option value="68">Cuijk</option>
			<option value="69">Culemborg</option>
			<option value="70">Dalfsen</option>
			<option value="71">Dantumadiel</option>
			<option value="72">De Bilt</option>
			<option value="73">De Marne</option>
			<option value="74">De Ronde Venen</option>
			<option value="75">De Wolden</option>
			<option value="76">Delft</option>
			<option value="77">Delfzijl</option>
			<option value="78">Den Haag</option>
			<option value="79">Den Helder</option>
			<option value="80">Deurne</option>
			<option value="81">Deventer</option>
			<option value="82">Diemen</option>
			<option value="83">Dinkelland</option>
			<option value="84">Dirksland</option>
			<option value="85">Doesburg</option>
			<option value="86">Doetinchem</option>
			<option value="87">Dongen</option>
			<option value="88">Dongeradeel</option>
			<option value="89">Dordrecht</option>
			<option value="90">Drechterland</option>
			<option value="91">Drimmelen</option>
			<option value="92">Dronten</option>
			<option value="93">Druten</option>
			<option value="94">Duiven</option>
			<option value="95">Echt-Susteren</option>
			<option value="96">Edam-Volendam</option>
			<option value="97">Ede</option>
			<option value="98">Eemnes</option>
			<option value="99">Eemsmond</option>
			<option value="100">Eersel</option>
			<option value="101">Eijsden-Margraten</option>
			<option value="102">Eindhoven</option>
			<option value="103">Elburg</option>
			<option value="104">Emmen</option>
			<option value="105">Enkhuizen</option>
			<option value="106">Enschede</option>
			<option value="107">Epe</option>
			<option value="108">Ermelo</option>
			<option value="109">Etten-Leur</option>
			<option value="110">Ferwerderadiel</option>
			<option value="111">Franekeradeel</option>
			<option value="112">Gaasterlan-Sleat</option>
			<option value="113">Geertruidenberg</option>
			<option value="114">Geldermalsen</option>
			<option value="115">Geldrop-Mierlo</option>
			<option value="116">Gemert-Bakel</option>
			<option value="117">Gennep</option>
			<option value="118">Giessenlanden</option>
			<option value="119">Gilze en Rijen</option>
			<option value="120">Goedereede</option>
			<option value="121">Goes</option>
			<option value="122">Goirle</option>
			<option value="123">Gorinchem</option>
			<option value="124">Gouda</option>
			<option value="125">Graafstroom</option>
			<option value="126">Graft-De Rijp</option>
			<option value="127">Grave</option>
			<option value="128">Groesbeek</option>
			<option value="129">Groningen</option>
			<option value="130">Grootegast</option>
			<option value="131">Gulpen-Wittem</option>
			<option value="132">Haaksbergen</option>
			<option value="133">Haaren</option>
			<option value="134">Haarlem</option>
			<option value="135">Haarlemmerliede en Spaarnwoude</option>
			<option value="136">Haarlemmermeer</option>
			<option value="137">Halderberge</option>
			<option value="138">Hardenberg</option>
			<option value="139">Harderwijk</option>
			<option value="140">Hardinxveld-Giessendam</option>
			<option value="141">Haren</option>
			<option value="142">Harenkarspel</option>
			<option value="143">Harlingen</option>
			<option value="144">Hattem</option>
			<option value="145">Heemskerk</option>
			<option value="146">Heemstede</option>
			<option value="147">Heerde</option>
			<option value="148">Heerenveen</option>
			<option value="149">Heerhugowaard</option>
			<option value="150">Heerlen</option>
			<option value="151">Heeze-Leende</option>
			<option value="152">Heiloo</option>
			<option value="153">Hellendoorn</option>
			<option value="154">Hellevoetsluis</option>
			<option value="155">Helmond</option>
			<option value="156">Hendrik-Ido-Ambacht</option>
			<option value="157">Hengelo</option>
			<option value="158">het Bildt</option>
			<option value="159">Heumen</option>
			<option value="160">Heusden</option>
			<option value="161">Hillegom</option>
			<option value="162">Hilvarenbeek</option>
			<option value="163">Hilversum</option>
			<option value="164">Hof van Twente</option>
			<option value="165">Hollands Kroon</option>
			<option value="166">Hoogeveen</option>
			<option value="167">Hoogezand-Sappemeer</option>
			<option value="168">Hoorn</option>
			<option value="169">Horst aan de Maas</option>
			<option value="170">Houten</option>
			<option value="171">Huizen</option>
			<option value="172">Hulst</option>
			<option value="173">IJsselstein</option>
			<option value="174">Kaag en Braassem</option>
			<option value="175">Kampen</option>
			<option value="176">Kapelle</option>
			<option value="177">Katwijk</option>
			<option value="178">Kerkrade</option>
			<option value="179">Koggenland</option>
			<option value="180">Kollumerland c.a.</option>
			<option value="181">Korendijk</option>
			<option value="182">Krimpen aan den IJssel</option>
			<option value="183">Laarbeek</option>
			<option value="184">Landerd</option>
			<option value="185">Landgraaf</option>
			<option value="186">Landsmeer</option>
			<option value="187">Langedijk</option>
			<option value="188">Lansingerland</option>
			<option value="189">Laren</option>
			<option value="190">Leek</option>
			<option value="191">Leerdam</option>
			<option value="192">Leeuwarden</option>
			<option value="193">Leeuwarderadeel</option>
			<option value="194">Leiden</option>
			<option value="195">Leiderdorp</option>
			<option value="196">Leidschendam-Voorburg</option>
			<option value="197">Lelystad</option>
			<option value="198">Lemsterland</option>
			<option value="199">Leudal</option>
			<option value="200">Leusden</option>
			<option value="201">Liesveld</option>
			<option value="202">Lingewaal</option>
			<option value="203">Lingewaard</option>
			<option value="204">Lisse</option>
			<option value="205">Littenseradiel</option>
			<option value="206">Lochem</option>
			<option value="207">Loon op Zand</option>
			<option value="208">Lopik</option>
			<option value="209">Loppersum</option>
			<option value="210">Losser</option>
			<option value="211">Maasdonk</option>
			<option value="212">Maasdriel</option>
			<option value="213">Maasgouw</option>
			<option value="214">Maassluis</option>
			<option value="215">Maastricht</option>
			<option value="216">Marum</option>
			<option value="217">Medemblik</option>
			<option value="218">Meerssen</option>
			<option value="219">Menameradiel</option>
			<option value="220">Menterwolde</option>
			<option value="221">Meppel</option>
			<option value="222">Middelburg</option>
			<option value="223">Middelharnis</option>
			<option value="224">Midden-Delfland</option>
			<option value="225">Midden-Drenthe</option>
			<option value="226">Mill en Sint Hubert</option>
			<option value="227">Millingen aan de Rijn</option>
			<option value="228">Moerdijk</option>
			<option value="229">Montferland</option>
			<option value="230">Montfoort</option>
			<option value="231">Mook en Middelaar</option>
			<option value="232">Muiden</option>
			<option value="233">Naarden</option>
			<option value="234">Neder-Betuwe</option>
			<option value="235">Nederlek</option>
			<option value="236">Nederweert</option>
			<option value="237">Neerijnen</option>
			<option value="238">Nieuwegein</option>
			<option value="239">Nieuwkoop</option>
			<option value="240">Nieuw-Lekkerland</option>
			<option value="241">Nijkerk</option>
			<option value="242">Nijmegen</option>
			<option value="243">Noord-Beveland</option>
			<option value="244">Noordenveld</option>
			<option value="245">Noordoostpolder</option>
			<option value="246">Noordwijk</option>
			<option value="247">Noordwijkerhout</option>
			<option value="248">Nuenen a.c.</option>
			<option value="249">Nunspeet</option>
			<option value="250">Nuth</option>
			<option value="251">Oegstgeest</option>
			<option value="252">Oirschot</option>
			<option value="253">Oisterwijk</option>
			<option value="254">Oldambt</option>
			<option value="255">Oldebroek</option>
			<option value="256">Oldenzaal</option>
			<option value="257">Olst-Wijhe</option>
			<option value="258">Ommen</option>
			<option value="259">Onderbanken</option>
			<option value="260">Oost Gelre</option>
			<option value="261">Oosterhout</option>
			<option value="262">Oostflakkee</option>
			<option value="263">Ooststellingwerf</option>
			<option value="264">Oostzaan</option>
			<option value="265">Opmeer</option>
			<option value="266">Opsterland</option>
			<option value="267">Oss</option>
			<option value="268">Oud-Beijerland</option>
			<option value="269">Oude IJsselstreek</option>
			<option value="270">Ouder-Amstel</option>
			<option value="271">Ouderkerk</option>
			<option value="272">Oudewater</option>
			<option value="273">Overbetuwe</option>
			<option value="274">Papendrecht</option>
			<option value="275">Peel en Maas</option>
			<option value="276">Pekela</option>
			<option value="277">Pijnacker-Nootdorp</option>
			<option value="278">Purmerend</option>
			<option value="279">Putten</option>
			<option value="280">Raalte</option>
			<option value="281">Reimerswaal</option>
			<option value="282">Renkum</option>
			<option value="283">Renswoude</option>
			<option value="284">Reusel-De Mierden</option>
			<option value="285">Rheden</option>
			<option value="286">Rhenen</option>
			<option value="287">Ridderkerk</option>
			<option value="288">Rijnwaarden</option>
			<option value="289">Rijnwoude</option>
			<option value="290">Rijssen-Holten</option>
			<option value="291">Rijswijk</option>
			<option value="292">Roerdalen</option>
			<option value="293">Roermond</option>
			<option value="294">Roosendaal</option>
			<option value="295">Rotterdam</option>
			<option value="296">Rozendaal</option>
			<option value="297">Rucphen</option>
			<option value="298">Schagen</option>
			<option value="299">Schermer</option>
			<option value="300">Scherpenzeel</option>
			<option value="301">Schiedam</option>
			<option value="302">Schiermonnikoog</option>
			<option value="303">Schijndel</option>
			<option value="304">Schinnen</option>
			<option value="305">Schoonhoven</option>
			<option value="306">Schouwen-Duiveland</option>
			<option value="307">'s-Hertogenbosch</option>
			<option value="308">Simpelveld</option>
			<option value="309">Sint Anthonis</option>
			<option value="310">Sint-Michielsgestel</option>
			<option value="311">Sint-Oedenrode</option>
			<option value="312">Sittard-Geleen</option>
			<option value="313">Skarsterlan</option>
			<option value="314">Sliedrecht</option>
			<option value="315">Slochteren</option>
			<option value="316">Sluis</option>
			<option value="317">Smallingerland</option>
			<option value="318">Soest</option>
			<option value="319">Someren</option>
			<option value="320">Son en Breugel</option>
			<option value="321">Spijkenisse</option>
			<option value="322">Stadskanaal</option>
			<option value="323">Staphorst</option>
			<option value="324">Stede Broec</option>
			<option value="325">Steenbergen</option>
			<option value="326">Steenwijkerland</option>
			<option value="327">Stein</option>
			<option value="328">Stichtse Vecht</option>
			<option value="329">Strijen</option>
			<option value="330">Sudwest Fryslan</option>
			<option value="331">Ten Boer</option>
			<option value="332">Terneuzen</option>
			<option value="333">Terschelling</option>
			<option value="334">Texel</option>
			<option value="335">Teylingen</option>
			<option value="336">Tholen</option>
			<option value="337">Tiel</option>
			<option value="338">Tilburg</option>
			<option value="339">Tubbergen</option>
			<option value="340">Twenterand</option>
			<option value="341">Tynaarlo</option>
			<option value="342">Tytsjerksteradiel</option>
			<option value="343">Ubbergen</option>
			<option value="344">Uden</option>
			<option value="345">Uitgeest</option>
			<option value="346">Uithoorn</option>
			<option value="347">Urk</option>
			<option value="348">Utrecht</option>
			<option value="349">Utrechtse Heuvelrug</option>
			<option value="350">Vaals</option>
			<option value="351">Valkenburg aan de Geul</option>
			<option value="352">Valkenswaard</option>
			<option value="353">Veendam</option>
			<option value="354">Veenendaal</option>
			<option value="355">Veere</option>
			<option value="356">Veghel</option>
			<option value="357">Veldhoven</option>
			<option value="358">Velsen</option>
			<option value="359">Venlo</option>
			<option value="360">Venray</option>
			<option value="361">Vianen</option>
			<option value="362">Vlaardingen</option>
			<option value="363">Vlagtwedde</option>
			<option value="364">Vlieland</option>
			<option value="365">Vlissingen</option>
			<option value="366">Vlist</option>
			<option value="367">Voerendaal</option>
			<option value="368">Voorschoten</option>
			<option value="369">Voorst</option>
			<option value="370">Vught</option>
			<option value="371">Waalre</option>
			<option value="372">Waalwijk</option>
			<option value="373">Waddinxveen</option>
			<option value="374">Wageningen</option>
			<option value="375">Wassenaar</option>
			<option value="376">Waterland</option>
			<option value="377">Weert</option>
			<option value="378">Weesp</option>
			<option value="379">Werkendam</option>
			<option value="380">West Maas en Waal</option>
			<option value="381">Westerveld</option>
			<option value="382">Westervoort</option>
			<option value="383">Westland</option>
			<option value="384">Weststellingwerf</option>
			<option value="385">Westvoorne</option>
			<option value="386">Wierden</option>
			<option value="387">Wijchen</option>
			<option value="388">Wijdemeren</option>
			<option value="389">Wijk bij Duurstede</option>
			<option value="390">Winsum</option>
			<option value="391">Winterswijk</option>
			<option value="392">Woensdrecht</option>
			<option value="393">Woerden</option>
			<option value="394">Wormerland</option>
			<option value="395">Woudenberg</option>
			<option value="396">Woudrichem</option>
			<option value="397">Zaanstad</option>
			<option value="398">Zaltbommel</option>
			<option value="399">Zandvoort</option>
			<option value="400">Zederik</option>
			<option value="401">Zeevang</option>
			<option value="402">Zeewolde</option>
			<option value="403">Zeist</option>
			<option value="404">Zevenaar</option>
			<option value="405">Zijpe</option>
			<option value="406">Zoetermeer</option>
			<option value="407">Zoeterwoude</option>
			<option value="408">Zuidhorn</option>
			<option value="409">Zuidplas</option>
			<option value="410">Zundert</option>
			<option value="411">Zutphen</option>
			<option value="412">Zwartewaterland</option>
			<option value="413">Zwijndrecht</option>
			<option value="414">Zwolle</option>
		</select>

		<script type="text/javascript">

			//Width and height
			var w = 1200;
			var h = 1500;
	
			//Create SVG element
			var svg = d3.select("body")
						.append("svg")
						.attr("width", w)
						.attr("height", h);
						
			//define the first graph
		    var first = svg.append("g")
						   .attr("transform","translate(0,0)")
			//define the second graph
			var second = svg.append("g")
						    .attr("transform","translate(0,"+11*h/20+")")			
						
			
						
			//Define map projection			
			var projection = d3.geoAlbersUsa()
					   .translate([180, 6*h/20])
					   .scale([450]);

		    //Define path generator
            var path = d3.geoPath()
			             .projection(projection);
				 
            //Define quantize scale to sort data values into buckets of color
            var color = d3.scaleQuantize()
			              .range(["rgb(224, 224, 224)","rgb(192,192,192)","rgb(160, 160, 160)","rgb(128, 128, 128)","rgb(96, 96, 96)","rgb(64, 64, 64)"]);
					
            var pack = d3.pack()
		                 .size([3.5*w/5,3.5*h/8])
		                 .radius(function(d){return Math.sqrt(d.data.NUMBER)/1.2;});
			

			
		   //default year
		    var defaultYear = "16";	  
						
			var defaultButton;
			
			//container for all buttons
			var allButtons= first.append("g")
						      .attr("transform","translate(20,50)")

		    // button labels
			var labels= ['2011','2012','2013','2014','2015','2016','2017'];

			//groups for each button (which will hold a rect and text)
			var buttonGroups= allButtons.selectAll("g.button")
						       .data(labels)
						       .enter()
						       .append("g")
						       .attr("class","button")
						       .style("cursor","pointer")
			                   .each(function(d,i){
			                   	   if(i==5)
								   defaultButton = this;
			                   })
			                   .on("click",function(d) {
								   var year_str = d.substring(2);
								   
								   updateButtonColors(d3.select(this), d3.select(this.parentNode));
								   // clear pack bubble, map and update year
 		  						   first.selectAll("circle")
								   .attr("fill","steelblue");
 	 							   
								   first.selectAll("text.llabel")
								   .text("0");
								   
								   first.select("text#year")
                                      .style("opacity", 0)
									  .transition()
									  .duration(1000)
									  .style("opacity", 1)
 	 							      .text(d);
									  
   			 					   first.selectAll("path")
									  .style("fill", function(d) {
   			 						   	return color(0);
   			 					   });
								   
								   first.selectAll("path")
								   .on("mouseover",null);
								   
								   // load data
								   loadByYear(year_str);
								   
								   // clear description column and map legend
								   setDefaultColumn();
								   setDefaultLegend();
								   
			                       })	
								   
			first.append("g")
				  .attr("id","circles")
				  .attr("transform","translate("+w/3+","+"0)");				
         
			//button width and height
			var bWidth= 40; //button width
			var bHeight= 15; //button height
			var x0= 0; //x offset
			var y0= 0; //y offset
			
			var defaultColor= "lightblue"
			var pressedColor= "grey"
			var bSpace= 5;
			
            buttonGroups.append("rect")
            .attr("class","buttonRect")
            .attr("width",bWidth)
            .attr("height",bHeight)
            .attr("x",function(d,i) {
                return x0+(bWidth+bSpace)*i;
            })
            .attr("y",y0)
            .attr("fill","lightblue")
			
            buttonGroups.append("text")
            .attr("class","buttonText")
            .attr("font-family","FontAwesome")
            .attr("x",function(d,i) {
                return x0 + (bWidth+bSpace)*i + bWidth/2;
            })
            .attr("y",y0+bHeight/2)
            .attr("text-anchor","middle")
            .attr("dominant-baseline","central")
            .attr("fill","white")
            .text(function(d) {return d;}) 
			
			function updateButtonColors(button, parent) {
			    parent.selectAll("rect")
			            .attr("fill",defaultColor)
			    button.select("rect")
			            .attr("fill",pressedColor)
			}  
			//define key function
			var key = function(d) {
				return d.data.COUNTRY_OF_CITIZENSHIP;
			};

			// add title
		    first.append("text") 
            .attr("x", 20)
            .attr("y",20)
            .attr("font-size","16")
		    .attr("font-weight","bold")
			.attr("fill",'rgb(96,96,96)')
            .text("Worksite Distribution of US Permnant Visa Applications (2011-2017)")
			
            // add subtitle
		    first.append("text") 
            .attr("x", 20)
            .attr("y", 40)
            .attr("font-size","12")
			.attr("fill",'rgb(96,96,96)')
            .text("as shown by the top 10 countries with high US Permanent Visa applications each year")
			
	        // add description columns
			first.append("text")
			 .attr("x", 20)
			 .attr("y", 110)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("Year:");
			 
			first.append("text")
			 .attr("id","year")
			 .attr("x", 60)
			 .attr("y", 110)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			
			
			first.append("text")
			 .attr("x", 20)
			 .attr("y", 133)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("Country of origin:");
			 
		   first.append("text")
			 .attr("id","country")
			 .attr("x", 140)
			 .attr("y", 133)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("rr");
			
			first.append("text")
			 .attr("x", 20)
			 .attr("y", 156)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("Total number of applications: ");
			
			first.append("text")
			 .attr("id","number")
			 .attr("x", 220)
			 .attr("y", 156)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			
			first.append("text")
			 .attr("id","number")
			 .attr("x", 20)
			 .attr("y", 200)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("Top 5 worksite states by number of applications");
			
			first.append("text")
			 //.attr("id","firstState")
			 .attr("x", 20)
			 .attr("y", 220)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","firstState")
			 .attr("x", 20)
			 .attr("y", 220)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","firstState1")
			 .attr("x", 220)
			 .attr("y", 220)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 //.attr("id","secondState")
			 .attr("x", 20)
			 .attr("y", 240)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","secondState")
			 .attr("x", 20)
			 .attr("y", 240)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","secondState1")
			 .attr("x", 220)
			 .attr("y", 240)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 //.attr("id","thirdState")
			 .attr("x", 20)
			 .attr("y", 260)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","thirdState")
			 .attr("x", 20)
			 .attr("y", 260)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","thirdState1")
			 .attr("x", 220)
			 .attr("y", 260)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
		  
		  
			first.append("text")
			 //.attr("id","thirdState")
			 .attr("x", 20)
			 .attr("y", 280)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","fourthState")
			 .attr("x", 20)
			 .attr("y", 280)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","fourthState1")
			 .attr("x", 220)
			 .attr("y", 280)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 //.attr("id","thirdState")
			 .attr("x", 20)
			 .attr("y", 300)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","fifthState")
			 .attr("x", 20)
			 .attr("y", 300)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
			 
			first.append("text")
			 .attr("id","fifthState1")
			 .attr("x", 220)
			 .attr("y", 300)
			 .attr("font-size",14)
			 .attr("fill",'rgb(96,96,96)')
			 .text("");
		 
		  function setDefaultColumn(){
			  
		      first.select("text#year")
              .text("2016")
			  
			  first.select("text#country")
			  .text("");
			  
			  first.select("text#number")
			  .text("");
			
			  first.select("text#firstState")
			  .text("");
			  
			  first.select("text#firstState1")
			  .text("");
			  
			  first.select("text#secondState")
			  .text("");
			  
			  first.select("text#secondState1")
			  .text("");
			  
			  first.select("text#thirdState")
			  .text("");
			  
			  first.select("text#thirdState1")
			  .text("");
			  
			  first.select("text#fourthState")
			  .text("");
			  
			  first.select("text#fourthState1")
			  .text("");
			  
			  first.select("text#fifthState")
			  .text("");
			  
			  first.select("text#fifthState1")
			  .text("");
		  }
			 

           //add legends
		  
		  var legend = first.append("g")
			 .attr("transform","translate(160,"+(8*h/20)+")");
		 
	         legend.append("rect")
			 .attr("width",40)
			 .attr("height",20)
			 .attr("fill","rgb(224, 224, 224)")
			 .attr("x", -100)
			 .attr("y",0);
			 
			 legend.append("text")
			 .attr("class","llabel")
			 .attr("id","llabel0")
             .attr("x", -110)
             .attr("y", 40)
             .attr("font-size","10")
             .text("0");
			 
			 
	         legend.append("rect")
			 .attr("width",40)
			 .attr("height",20)
			 .attr("fill","rgb(192,192,192)")
			 .attr("x", -60)
			 .attr("y",0);
			 
			 legend.append("text")
			 .attr("class","llabel")
			 .attr("id","llabel1")
             .attr("x", -70)
             .attr("y", 40)
             .attr("font-size","10")
             .text("0");
			 
	         legend.append("rect")
			 .attr("width",40)
			 .attr("height",20)
			 .attr("fill","rgb(160, 160, 160)")
			 .attr("x", -20)
			 .attr("y",0);
			 
			 legend.append("text")
			 .attr("class","llabel")
			 .attr("id","llabel2")
             .attr("x", -30)
             .attr("y", 40)
             .attr("font-size","10")
             .text("0");
			 
	         legend.append("rect")
			 .attr("width",40)
			 .attr("height",20)
			 .attr("fill","rgb(128, 128, 128)")
			 .attr("x", 20)
			 .attr("y",0);
			 
			 legend.append("text")
			 .attr("class","llabel")
			 .attr("id","llabel3")
             .attr("x", 10)
             .attr("y", 40)
             .attr("font-size","10")
             .text("0");
			 
	         legend.append("rect")
			 .attr("width",40)
			 .attr("height",20)
			 .attr("fill","rgb(96, 96, 96)")
			 .attr("x", 60)
			 .attr("y",0);
			 
			 legend.append("text")
			 .attr("class","llabel")
			 .attr("id","llabel4")
             .attr("x", 50)
             .attr("y", 40)
             .attr("font-size","10")
             .text("0");
			 
	         legend.append("rect")
			 .attr("width",40)
			 .attr("height",20)
			 .attr("fill","rgb(64, 64, 64)")
			 .attr("x", 100)
			 .attr("y",0);
			 
			 legend.append("text")
			 .attr("class","llabel")
			 .attr("id","llabel5")
             .attr("x", 90)
             .attr("y", 40)
             .attr("font-size","10")
             .text("0");
 
			 
			 legend.append("text")
			 .attr("class","llabel")
			 .attr("id","llabel6")
             .attr("x", 130)
             .attr("y", 40)
             .attr("font-size","10")
             .text("0");
			 
			 
			 
			 legend.append("text")
             .attr("x", -100)
             .attr("y", -10)
             .attr("font-size","12")
             .text("number of applications (thousand)");
		
		     function setDefaultLegend(){
			   legend.selectAll('text.llabel')
			         .text("0")
		     }
		 
			 
			 
			 
			 //default year, description and legend
			 updateButtonColors(d3.select(defaultButton), d3.select(defaultButton.parentNode));
			 loadByYear(defaultYear);
		     setDefaultColumn();
		     setDefaultLegend();
			 
			 
			 
			// load data for a specific year
			function loadByYear(year){
				 
	 		// define variables storing number of applications by state
	 		var g_json;
			
				 
	 		d3.csv("top10_"+year+"_state.csv", function(data) {
				   
			
				
	 				color.domain([d3.min(data, function(d) { return +d.value; }), 
	 					          d3.max(data, function(d) { return +d.value; })]);
               
	 				//Load in GeoJSON data
	 				d3.json("us-states.json", function(json) {
	 				    g_json = json
	 					for (var i = 0; i < data.length; i++) {			
						
	 						//Grab state name
	 						var dataState = data[i].state;			
	 						//Grab data value, and convert from string to float
	 						var dataValue = parseFloat(data[i].value);		
	 						//Find the corresponding state inside the GeoJSON
	 						var country = data[i].COUNTRY_OF_CITIZENSHIP;
	 						for (var j = 0; j < json.features.length; j++) {			
	 							var jsonState = json.features[j].properties.name;
	 							if (dataState == jsonState) {
	 								g_json.features[j].properties[country]= dataValue;
	 								//Stop looking through the JSON
	 								break;
	 							}
	 						 }
								
	 					}
	 					first.selectAll("path")
	 					   .data(g_json.features)
	 					   .enter()
	 					   .append("path")
	 					   .attr("d", path)
	 					   .style("fill", function(d) {
	 						   	return color(0);
	 					   });
	 				});
			
				
			
	 			});
					
			  d3.json("top10_"+year+".json",function(data){
				 
				
			
	            var nodes = d3.hierarchy(data)
				  .sum(function(d) { return d.NUMBER; })
				  .sort(function(a, b) { return a.NUMBER - b.NUMBER; });

			
				 
				var update = first.select("g#circles")
				             .selectAll(".node")
				             .data(pack(nodes).descendants(),key);

				    
				       update.transition()
				             .duration(1500)
				             .ease(d3.easeCubic)
							 .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
				             .select("circle")
				             .attr("r",function(d){return d.r});
							
				     
					   update.select("text")
							 .style("opacity", 0)
                             .transition().duration(1500)
                             .style("opacity", 1)
				             .text(function(d){return d.children? "":d.data.COUNTRY_OF_CITIZENSHIP});
      				  
				var enter_g = update.enter()
							   .append("g")
							   
				               .attr("class","node")
							   .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
					           
				    enter_g.append("circle")
							   .transition()
				               .duration(1500)
				               .ease(d3.easeCubic)
					           .attr("r",function(d){return d.r;})
				               .attr("fill","steelblue")
					           .attr("opacity",0.25)
					           .attr("stroke","#ADADAD")
					           .attr("stroke-width","2")
							   
								   
				    enter_g.append("text")
								.style("opacity", 0)
                                .transition().duration(1500)
                                .style("opacity", 1)
								.ease(d3.easeCubic)
	                            .style("text-anchor", "middle")
	   		   					.text(function(d){return d.children? "":d.data.COUNTRY_OF_CITIZENSHIP})
	   		   					.attr("font-size","12")
	   		   					.attr("pointer-events", "none");

				   update.exit().remove();
				           
						  
				    enter_g.merge(update)
						     .selectAll("circle")  
					         .on("click",function(d){
						          d3.selectAll("circle")
						          .attr("fill","steelblue");
						 
						           if(!d.children){
						           d3.select(this)
						           .attr("fill","rgb(102,51,0)");
					     
						           // link the map
						           var country = d.data.COUNTRY_OF_CITIZENSHIP;
						           var number = d.data.NUMBER;
						           var state_num=[];
		  				   
   					                first.selectAll("path")
						            .each(function(d){
								    var value = d.properties[country];
								    state_num.push([d.properties.name,value]);	
								
						            });
						
							        // set the domain specific to the country of interest 
							 
							        var minValue = d3.min(state_num, function(d) { return d[1]; });
							        var maxValue = d3.max(state_num, function(d) { return d[1]; });
							        
									color.domain([minValue, maxValue]);
							
  					                first.selectAll("path")
   					                   .style("fill", function(d) {
   					   		        //Get data value
   					   		        var value = d.properties[country];	   		
   						   	 
							        return color(value);
   					                });
									
									first.selectAll("path")
									   .on("mouseover",function(d){
									  // console.log(d3.select(this))
									var x = d3.mouse(this)[0];
								    var y = d3.mouse(this)[1];
									var tooltip=
									d3.select("#tooltip")
									  .style("left",x+"px")
                                      .style("top",y+"px")
									tooltip.select("#year")
									   .text("year:  20"+year)
									tooltip.select("#country")
									   .text("country of origin: "+country)
									tooltip.select("#state")
									   .text("state of worksite: "+d.properties.name)
									tooltip.select("#value")
									  .text("number of applications:  "+d.properties[country])
									d3.select("#tooltip").classed("hidden",false);
									  	
									 })
									   .on("mouseout",function(){
										  // d3.select("#tooltip").remove();
										  d3.select("#tooltip").classed("hidden",true);
									   })
									  
										
									      
									   
									 
							
							         // link to the description column
							        first.select("text#country")
									.style("opacity", 0)
									.transition()
									.duration(1000)
									.style("opacity", 1)
							        .text(country);
							
							  
							         first.select("text#number")
									  .style("opacity", 0)
									  .transition()
									  .duration(1000)
									  .style("opacity", 1)
							          .text(number);
							  
							         // sort the state_num array to find out the first three
							         state_num.sort(function(a,b){return b[1]-a[1]});
							         
									 var first_name = state_num[0][0];
							         var first_num = state_num[0][1];
							         var second_name = state_num[1][0];
							         var second_num = state_num[1][1];
							         var third_name = state_num[2][0];
							         var third_num = state_num[2][1]; 
							         var fourth_name = state_num[3][0];
							         var fourth_num = state_num[3][1]; 
							         var fifth_name = state_num[4][0];
							         var fifth_num = state_num[4][1]; 
							  
							         first.select("text#firstState")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
							            .text("1. "+first_name);
									 
							         first.select("text#firstState1")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
										.text(first_num)
							  
							         first.select("text#secondState")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
							            .text("2. "+second_name);
										
							         first.select("text#secondState1")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
							            .text(second_num);
							  
							         first.select("text#thirdState")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
							            .text("3. "+third_name);
										
							         first.select("text#thirdState1")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
							            .text(third_num);
										
							         first.select("text#fourthState")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
							            .text("4. "+fourth_name);
										
							         first.select("text#fourthState1")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
							            .text(fourth_num);
							         
									 first.select("text#fifthState")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
							            .text("5. "+fifth_name);
										
							         first.select("text#fifthState1")
                                        .style("opacity", 0)
									    .transition()
									    .duration(1000)
									    .style("opacity", 1)
							            .text(fifth_num);
							  
							  
							         // link to the legend 
							         var interval = (maxValue - minValue)/6;
							            for(var i=0;i<=6;i=i+1){
							  	            var number = minValue+i*interval;
								            legend.select("text#"+"llabel"+i).text((number/1000).toFixed(2));
								
							         }
							  
					         
						 }
						 
						 else{
						 //disable mouseover event	 
						 first.selectAll("path")
						   .on("mouseover",null);
							 // clear map
   					      first.selectAll("path")
   					         .data(g_json.features)
							 .style("fill",color(0));
							 // clear legend labels
						  first.selectAll("text.llabel")
						  .text("0");
							 
						  first.select("text#country")
						  .text("");
						  
						  first.select("text#number")
						  .text("");
						  
						  first.select("text#firstState")
						  .text("");
						  
						  first.select("text#secondState")
						  .text("");
						  
						  first.select("text#thirdState")
						  .text("");
						  
						  first.select("text#fourthState")
						  .text("");
						  
						  first.select("text#fifthState")
						  .text("");
						  
						  first.select("text#firstState1")
						  .text("");
						  
						  first.select("text#secondState1")
						  .text("");
						  
						  first.select("text#thirdState1")
						  .text("");
						  
						  first.select("text#fourthState1")
						  .text("");
						  
						  first.select("text#fifthState1")
						  .text("");
						 }
						 
					});

		
				    
					
					

			});

			
			
		}
		
		// second graph
		
		
		// title
		second.append("text") 
            .attr("x",30)
            .attr("y",0)
            .attr("font-size","16")
		    .attr("font-weight","bold")
			.attr("fill",'rgb(96,96,96)')
		.text("Wage Rates Proposed by H-1B Employers (2015-2017)");
		
		// subtitle 1
		second.append("text") 
            .attr("x", 30)
            .attr("y", 20)
            .attr("font-size","14")
			.attr("fill",'rgb(96,96,96)')
		.text("as shown by median wages offered by H-1B independent and dependent employers from the largest 50 cities");
		
		
		
		
		
        var projection2 = d3.geoAlbersUsa()
					      .translate([w/1.9, 0.23*h])
					      .scale([800]);
		
		var path1 = d3.geoPath()
						 .projection(projection2)
						 
						 
	  // var color2 = d3.scaleQuantize()
						//.range(["rgb(237,248,233)","rgb(186,228,179)","rgb(116,196,118)","rgb(49,163,84)","rgb(0,109,44)"]);
						//Colors taken from colorbrewer.js, included in the D3 download

	   //Number formatting for population values
	   var formatAsThousands = d3.format(",");  //e.g. converts 123456 to "123,456"
	   
	   // key function
	   var key1 = function(d) {
		return d.city;
	   };
	   


		
		
		 
		var defaultButton1;
		var defaultButton2;
        var year_str="2016";
		var dependent_str = "independent"; 
		
		//container for all buttons
		var allButtons1 = second.append("g")
								.attr("transform","translate(30,30)");
        
		var allButtons2 = second.append("g")
								.attr("transform","translate(950,20)")
	    // button labels
		var labels1= ['2015','2016','2017'];
		var labels2= ['H-1B Independent Employers','H-1B Dependent Employers'];
        
		//groups for each button (which will hold a rect and text)
		var buttonGroups1= allButtons1.selectAll("g.button1")
					       .data(labels1)
					       .enter()
					       .append("g")
					       .attr("class","button1")
					       .style("cursor","pointer")
		                   .each(function(d,i){
		                   	   if(i==2)
							   defaultButton1 = this;
		                   })
		                   .on("click",function(d) {
							   year_str = d;
							   
							   updateButtonColors(d3.select(this), d3.select(this.parentNode));
							   load_data(year_str,dependent_str);
							   // clear pack bubble, map and update year
		                    });	
 		
		var buttonGroups2= allButtons2.selectAll("g.button2")
 					       .data(labels2)
 					       .enter()
 					       .append("g")
 					       .attr("class","button2")
 					       .style("cursor","pointer")
 		                   .each(function(d,i){
 		                   	   if(i==0)
 							   defaultButton2 = this;
 		                   })
 		                   .on("click",function(d) {
 							   dependent_str = d.split(" ")[1];
							  
 							   updateButtonColors(d3.select(this), d3.select(this.parentNode));
							   load_data(year_str,dependent_str);
 							   // clear pack bubble, map and update year
 		                    });					
		
							   
		buttonGroups1.append("rect")
					 .attr("class","buttonRect1")
					 .attr("width",bWidth)
					 .attr("height",bHeight)
					 .attr("x",function(d,i) {
					      return x0+(bWidth+bSpace)*i;
					 })
					 .attr("y",y0)
					 .attr("fill","lightblue")
		
		buttonGroups2.append("rect")
					 .attr("class","buttonRect2")
					 .attr("width",bHeight)
					 .attr("height",bHeight)
					 .attr("y",function(d,i) {
					      return y0+(bHeight+bSpace)*i+2;
					 })
					 .attr("x",x0)
					 .attr("fill","lightblue")
		
	    buttonGroups1.append("text")
					 .attr("class","buttonText1")
					 .attr("font-family","FontAwesome")
					 .attr("x",function(d,i) {
					     return x0 + (bWidth+bSpace)*i + bWidth/2;
					  })
					 .attr("y",y0+bHeight/2)
					 .attr("text-anchor","middle")
					 .attr("dominant-baseline","central")
					 .attr("fill","white")
					 .text(function(d) {return d;}) 
 	    
		buttonGroups2.append("text")
 					 .attr("class","buttonText2")
 					 .attr("font-family","FontAwesome")
 					 .attr("y",function(d,i) {
 					      return y0+(bHeight+bSpace)*i+bHeight;
 					 })
 					 .attr("x",x0+2*bHeight)
 					 .text(function(d) {return d;}) 
	
				 
		updateButtonColors(d3.select(defaultButton1), d3.select(defaultButton1.parentNode));  
		updateButtonColors(d3.select(defaultButton2), d3.select(defaultButton2.parentNode));
		second.append("text")
		      .attr("id","city_wage")
		      .attr("x",950)
		      .attr("y",100)
		
		var load_data = function(year,dependent){
			
			d3.csv("h1b_"+year+"_"+dependent+".csv", function(data) {
			
						d3.json("us-states.json", function(json) {

			
					     second.selectAll("path")
							   .data(json.features)
							   .enter()
							   .append("path")
							   .attr("d", path1)
							   .attr("fill", "#ccc")
							   .style("stroke","white");
			
	          
				
					     var update = second.selectAll("circle")
							   			   .data(data,key1)
				   
				          update.transition()
				             .duration(1500)
				             .ease(d3.easeCubic)
				             .attr("r",function(d){return Math.sqrt(parseInt(d.median_wage) * 0.006)})
			   			 	 
				
	        
			 
				       	  var enter_g = update.enter()
							                 .append("circle")
							                 .attr("cx", function(d) {
								   			 return projection2([d.lon, d.lat])[0];
							   		  		 })
							   			  	.attr("cy", function(d) {
								   			 return projection2([d.lon, d.lat])[1];
							   		  		})
							   			 	.attr("r", function(d) {
												return Math.sqrt(parseInt(d.median_wage) * 0.006);
							   			 	})
							   			 	.style("fill", "steelblue")
							   			 	.style("stroke", "gray")
							   			 	.style("stroke-width", 0.25)
							   			 	.style("opacity", 0.6)
											
							      update.exit().remove();
									 
									
								  second.selectAll("circle")
	 									.on("click",function(d){
											   
	 									second.select("text#city_wage")
											  .text("median wage: "+d.median_wage)
	 									});
										
	 									
							   			 	
				  
							  
						       });
			

					 });
		 
		}
		
		load_data(year_str,dependent_str);
        

		</script>
	</body>
</html>